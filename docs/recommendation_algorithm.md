# 推荐阅读算法实现说明

本文档详细介绍了 RunJPLib 项目中推荐阅读功能的时间权重算法实现。

## 1. 算法概述

推荐阅读功能使用时间权重算法，确保最新的博客文章有更高的展示权重，同时保持内容的多样性和避免重复推荐。

## 2. 算法逻辑

### 2.1 时间分组
算法首先将博客按时间分为三个组：
- **最近3天**: 最高权重组
- **最近7天**: 中等权重组  
- **更早**: 基础权重组

### 2.2 选择步骤

#### Step 1: 从最近3天的blog中选2条
- 目标：选择2条最近3天的博客
- 实现：使用 `random.sample()` 随机选择，但不超过可用数量
- 如果最近3天没有博客，跳过此步骤

#### Step 2: 从最近7天的blog中选不重复的补足3条
- 目标：从最近7天的博客中补足到总共3条
- 实现：
  - 计算还需要多少篇：`needed_from_7_days = 3 - len(selected_blogs)`
  - 从可选的7天博客中随机选择需要的数量
  - 确保不重复选择已选中的博客

#### Step 3: 从剩下的blog中选不重复的补足3条
- 目标：从剩余博客中补足到总共3条
- 实现：从所有未选择的博客中随机选择需要的数量
- 作为兜底机制，确保总能推荐到指定数量的文章

## 3. 技术实现

### 3.1 核心函数
```python
def get_weighted_recommended_blogs_with_summary(count=3):
    """
    根据时间权重算法获取推荐博客，并生成摘要。
    """
```

### 3.2 关键特性
- **日期比较优化**: 使用 `.date()` 方法只比较日期部分，忽略时间部分
- **去重机制**: 使用 `used_url_titles` 集合避免重复推荐
- **容错处理**: 如果某个步骤失败，自动回退到随机推荐算法
- **详细日志**: 提供完整的debug日志，便于跟踪算法执行过程

### 3.3 数据结构
```python
# 博客对象结构
{
    'title': '博客标题',
    'url_title': 'URL友好的标题',
    'publication_date': '2025-08-26',  # 字符串格式
    'content_md': 'Markdown内容'
}

# 返回结果结构
{
    'title': '博客标题',
    'url_title': 'URL友好的标题', 
    'summary': '生成的摘要'
}
```

## 4. 应用场景

### 4.1 首页推荐
- 位置：首页的"推荐阅读"板块
- 数量：3篇博客
- 更新频率：每次页面加载时重新计算

### 4.2 博客详情页
- 位置：博客详情页的推荐阅读部分
- 数量：3篇博客
- 特点：不包含当前正在阅读的博客

### 4.3 404页面
- 位置：404错误页面的推荐内容
- 数量：10篇博客（特殊情况）
- 目的：引导用户发现其他内容
