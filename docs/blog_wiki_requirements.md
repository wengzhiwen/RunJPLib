# Blog板块Wiki功能需求文档

## 项目概述

为RunJPLib项目的blog板块添加类似wiki的功能，在生成/更新blog时自动识别学校名称并添加超链接，连接到本项目的大学招生信息基本分析报告展示页。

## 功能需求

### 核心功能
1. **自动识别学校名称**: 在blog内容中自动识别数据库中存在的大学名称（中文名和日文名）
2. **自动添加超链接**: 为识别到的学校名称自动添加超链接，链接到对应的大学招生信息页面
3. **支持多语言**: 同时支持中文名和日文名的识别与链接
4. **智能去重**: 避免同一学校名称在同一篇blog中重复添加超链接

### 技术需求
1. **实时处理**: 在blog生成/更新时实时处理，无需手动干预
2. **性能优化**: 处理过程不应显著影响blog的生成和更新速度
3. **错误处理**: 优雅处理识别失败、链接生成失败等异常情况
4. **日志记录**: 记录wiki功能的处理过程和结果

## 现状分析

### 当前情况
- **已有超链接**: 部分blog中已经人工添加了学校名称的超链接
- **缺失超链接**: 大量blog中的学校名称没有超链接
- **数据库支持**: MongoDB中存储了333所大学的中文名和日文名
- **链接格式**: 超链接格式为 `[学校名称](https://www.runjplib.com/university/学校名称)`

### 示例分析
从随机抽取的30篇blog中发现：

**已有超链接的学校名称**:
- 東京大学 (东京大学)
- 京都大学 (京都大学)
- 大阪大学 (大阪大学)
- 早稲田大学 (早稻田大学)
- 慶應義塾大学 (庆应义塾大学)
- 上智大学 (上智大学)
- 東京理科大学 (东京理科大学)
- 芝浦工業大学 (芝浦工业大学)
- 筑波大学 (筑波大学)
- 東京科学大学 (东京科学大学)
- 女子美術大学 (女子美术大学)
- 京都精華大学 (京都精华大学)

**缺失超链接的学校名称**:
- 東京藝術大学 (东京艺术大学)
- 多摩美術大学 (多摩美术大学)
- 武蔵野美術大学 (武藏野美术大学)
- 京都藝術大学 (京都艺术大学)

### 数据库中的大学信息
- **集合名称**: `universities`
- **字段结构**: 
  - `university_name`: 日文名称
  - `university_name_zh`: 中文名称
- **数据量**: 333所大学
- **覆盖范围**: 包括国立、公立、私立大学，涵盖各个专业领域

## 实现方案

### 保存时自动处理
1. **集成到AI生成流程**: 在blog生成完成后，或人工编辑之后，点击保存按钮时，自动调用wiki处理函数
2. **识别方式**: 使用已有的学校名称（有限集合，大概就是去重后不到400个日文名+不到400个中文名）反向匹配blog的文字
3. **自动链接**: 匹配上的学校名称（有多个匹配就选文字数最长的那一个，因为那一个往往是更加精确到学部名的）加上超链接
4. **内容更新**: 更新blog的markdown内容后将处理完成后的blog内容update / insert到MongoDB中

#### 注意
- 已经有超链接的不论对错，不要重复添加超链接

## 技术实现细节

### 超链接生成
1. **链接格式**: `[学校名称](https://www.runjplib.com/university/学校名称)`
2. **编码处理**: 正确处理中文和日文字符的URL编码
3. **去重处理**: 同一学校名称在同一篇blog中只添加一次超链接
4. **位置保持**: 保持原有的文本格式和位置

### 性能优化
1. **缓存机制**: 缓存学校名称匹配结果，避免重复查询
2. **批量处理**: 支持批量处理多个学校名称
3. **异步处理**: 对于大量数据的处理使用异步方式
4. **增量更新**: 只处理新增或修改的内容

## 用户界面

上述方案应该对用户毫无感知，都是自动完成的。

