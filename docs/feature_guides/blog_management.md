# 博客管理与 AI 生成

RunJPLib 提供了一套完整的博客管理功能，并集成了强大的 AI 辅助创作工具，帮助管理员高效地生成和管理内容。

## 博客管理

管理员可以通过后台的“Blog 一览”页面 (`/admin/manage/blogs`) 对所有博客文章进行管理。

- **查看与编辑**: 可以查看所有已发布的博客，并直接在线编辑任何一篇文章的标题和 Markdown 原文。
- **删除**: 可以删除不再需要的博客文章。
- **新建**: 点击“新建博客”按钮，即可进入 AI 博客生成器页面。

## AI 博客生成器

这是管理后台的核心内容创作工具，允许管理员通过 AI 辅助，以多种模式创建博客文章。

### 生成模式

1.  **材料扩展模式**:
    - **用途**: 基于一所或多所大学的招生简章原文，结合用户的具体要求进行扩展创作。
    - **Web Search 支持**: 在此模式下，系统可以额外启用网络检索功能，从日语的权威来源查找补充材料，丰富文章内容。

2.  **对比分析模式**:
    - **用途**: 用于生成多所大学的横向对比或综合推荐类文章。
    - **智能缩减**: 系统会先智能地缩减每所大学的原文材料，提取核心要点，然后再将这些要点交给 AI 进行对比和分析。

3.  **纯用户提示词模式**:
    - **用途**: 完全脱离现有的大学材料，仅根据管理员输入的提示词、草稿或主题进行创作和优化。

### 使用流程 (异步)

1.  **配置生成参数**: 在“新建博客”页面，选择生成模式、大学（如果需要）并填写好提示词。
2.  **提交生成任务**: 点击“提交生成任务”按钮。系统会立即响应，提示任务已开始，管理员无需等待。
3.  **后台处理**: 后台线程池会接收该任务，并执行耗时的 AI 内容生成操作。
4.  **查看结果**: 生成完成后，一篇新的博客文章会自动出现在“Blog 一览”页面。这篇新文章**默认为“私密”状态**，不会对普通访客显示。
5.  **审核与发布**: 管理员可以点击“编辑”来审核、修改内容，并在确认无误后，将其状态切换为“公开”来完成发布。

## 可见性控制与发布

为了实现“先生成、后审核、再发布”的安全工作流，博客系统引入了可见性控制。

- **`is_public` 字段**: 每篇博客都有一个 `is_public` 状态（公开或私密）。
- **状态切换**: 在博客的“编辑”页面，管理员可以通过一个开关轻松切换其可见状态。
- **默认状态**:
    - **AI 生成的博客**: 默认为 `私密`。
    - **手动创建的博客**: 默认为 `公开`。
- **前端显示**: 网站的所有公开部分（如博客列表、首页推荐、站点地图等）只会显示状态为“公开”的博客文章，确保了私密草稿不会意外泄露。

## 快速再生成

如果对 AI 生成的某篇文章基本满意但希望微调，可以使用“再生成”功能。

- **触发**: 在编辑一篇由 AI 生成的博客时，页面上会出现一个“再生成”按钮。
- **功能**: 点击该按钮，会自动在新标签页中打开“新建博客”页面，并**自动填充**上一次生成该文章时使用的所有参数（模式、大学、用户提示词、系统提示词）。
- **用途**: 管理员可以在原有参数的基础上进行微调，然后提交一个新的生成任务，从而快速迭代内容，而无需从头填写所有信息。

## 自动 Wiki 功能

为了增强站内内容的关联性，博客系统集成了自动 Wiki 功能。

- **自动链接**: 在博客文章被保存或更新时，系统会自动识别内容中出现的大学名称（支持中文和日文），并为其添加指向本站对应大学信息页面的超链接。
- **智能处理**: 该功能会自动避免重复添加链接，并且对管理员完全透明，无需任何手动操作。

## API 端点

- `GET /admin/api/universities/search`: 根据查询参数 `q` 搜索大学。
- `POST /admin/api/blog/generate`: **(异步)** 接收生成参数，将其提交到后台任务队列并立即返回，不直接返回生成的博客内容。
- `POST /admin/api/blog/save`: 接收标题和Markdown内容，将其存入`blogs`集合。