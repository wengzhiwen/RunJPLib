# 数据管理工具

本文档描述了RunJPLib项目用于管理MongoDB数据库内容的后台工具。

## 概述

随着项目数据源完全迁移至MongoDB，我们建立了一个基于Web的内部管理后台，以取代旧的、基于本地文件的管理方式。该后台是所有大学信息和博客文章的统一管理入口。

## 技术架构

- **后端**: 基于Flask框架，使用`Blueprint`构建，路由位于`/admin`。
- **认证**: 通过JWT (JSON Web Tokens) 实现。
    - 认证凭证以`HttpOnly` Cookie的形式存储，增强了安全性。
    - 所有后台页面和API均受到保护，未认证的页面访问会被重定向至登录页。
- **前端**: 使用基础的HTML、CSS和JavaScript，通过API与后端进行异步数据交互。

## 主要功能

### 1. 登录 (`/admin/login`)
管理员通过输入在环境变量中配置的`ACCESS_CODE`进行登录，成功后服务器会下发认证Cookie。

### 2. 仪表盘 (`/admin`)
后台首页，是各个管理模块的入口。

### 3. 大学信息管理 (`/admin/manage/universities`)
- **数据展示**: 以表格形式展示当前`universities`集合中的所有文档。
- **核心操作**:
    - **查看**: 提供跳转链接，可在用户前端视角查看该大学的详情页面。
    - **删除**: 支持删除单条大学信息。
    - **清空**: 支持一键清空整个`universities`集合（危险操作，需要确认）。

### 4. 博客文章管理 (`/admin/manage/blogs`)
- **数据展示**: 以表格形式展示`blogs`集合中的所有文章，并包含以下关键信息：
    - **Markdown更新时间**: `md_last_updated`字段，在上传时自动更新。
    - **HTML更新时间**: `html_last_updated`字段，在“延迟渲染”机制触发时更新。
    - **HTML状态**: 根据上述两个时间戳动态计算，直观展示HTML内容是否为最新。
- **核心操作**:
    - **查看**: 提供跳转链接，可在用户前端视角查看该博客文章。
    - **删除**: 支持删除单篇博客。
    - **清空**: 支持一键清空整个`blogs`集合。

## 数据源
本项目已**完全移除**对本地文件系统的依赖（`pdf_with_md*`文件夹和旧的`blogs`文件夹）。所有大学和博客数据均以MongoDB为唯一数据源。
- **大学PDF文件**: 通过GridFS进行存储和提供服务，解决了MongoDB的16MB文档大小限制。
- **数据缓存**: 对频繁访问的数据（如首页大学列表、博客列表、分类信息）在应用层进行了基于时间的内存缓存，以提升性能并降低数据库负载。
