# 数据管理工具

这是一个全新的需求，目标是将本地的文件数据库移行到MongoDB。
与此相关的所有的管理工具。

## MongoDB

通过 Google cloud MongoDB Atlas创建了MongoDB的实例。

实例的访问方式可以参考项目根目录的 test_mongodb_basic.py

允许Gemini Code或Cursor对MongoDB做任何操作，但所有涉及架构设计的工作都必须在 docs/mongoDB_design.md 中留下记录，使得后续工作可以参考。

## 现状

所有的数据都以文件的形式存在，主要有两个部分：

 - 大学招生信息：项目目录中所有的 pdf_with_md* 文件夹中
 - blog文章：项目目录中的 blogs 文件夹中

 具体的使用（读取）方法，可以参考现有的 routes 中的代码。

## 工具设计

简单来说就是要创建一个管理员（admin）使用的后台，分为以下部分：

 - 数据批量上传（将现有的文件数据库中的文件批量传输到MongoDB上，原则上只会使用一次，但也可能为了调整优化多次尝试。因为文件数目很多要设计一个合理的断点续传的方案）
    - 大学招生信息：
        - 元数据现在都是以文件夹名或文件名的形式存在的要改用JSON字段的方式
        - 全文OCR、全文翻译、report的markdown文件内容全部放到MongoDB上
        - pdf文件的内容全部放到MongoDB上
        - log文件、scan的中间结果不用保存到MongoDB上（因为是中间结果）
        - 因为本地有多个 pdf_with_md* 文件夹，要支持可以选择特定的文件夹来启动上传（对调试特别重要，每次都只能全量上传的话太可怕了）
    - blog:
        - 元数据现在都是以文件名的形式存在的要改用JSON字段的方式
        - 的markdown文件全部放到MongoDB上
 - 数据管理
    - 直接管理MongoDB中管理的数据（修改元数据 / 删除）
        - 支持一次清空大学招生信息 或 一次清空blog，以便于重新上传
    - 直接查看MongoDB中管理的数据，有URL可以直接通过用户的视角（现有的View）查看MongoDB中的数据
        - 当然要对现有的View进行改造，支持通过mongoDB读取数据
        - 未来会有明确的需求提出，整个项目都通过mongoDB来load，现在只是准备后台，所以用户前端暂时只改造查看具体信息的View，不改造
 - 数据生成
    - 先挖一个坑，后续会把之前用于数据生成的项目整合进来，基于之前的代码来做数据生成的工作。生成的代码直接上传到MongoDB，也支持调整参数重新生成
    - 总之这部分先做过架构设计，留好GUI入口，不用实际实现

### 安全

已经在 .env 文件（虽然你不能直接访问，这是正常的）中加入了 ACCESS_CODE 字段。访问后台时如果没有合法的token会自动转到login页面，要求输入正确的 ACCESS_CODE 获得 Admin Role的Token才能访问本设计中涉及的后台功能。

除了保护前端，也要注意保护API。

### 技术设计

前端已经使用了flask，所以后台一样整合在同一个flask上就好了。技术设计不要搞太复杂。

每次编码完成后都要创建或更新对应的README文件以帮助其他Agent的后续工作。